covid19$縣市, levels=newLevels
)
levels(covid19$縣市)
levels(covid19$年齡層)
level_names <- levels(covid19$年齡層)
startingAges <- stringr::str_extract(
level_names,
"^[0-9]+" # regex：開頭的一串數字
)
level_names <- levels(covid19$年齡層)
startingAges <- stringr::str_extract(
level_names,
"^[0-9]+" # regex：開頭的一串數字
)
startingAges
# 要numerical class排的才一定對
startingAges <- as.integer(startingAges)
names(startingAges) <- level_names
sort(startingAges) -> startingAges
covid19$年齡層 <-
factor(
covid19$年齡層, names(startingAges)
)
levels(covid19$年齡層)
# 要numerical class排的才一定對
startingAges <- as.integer(startingAges)
names(startingAges) <- level_names
startingAges
factor1 <- factor(
c("A","A","C","A","D","F","D","D")
)
factor1
levels(factor1) <- c("優","佳","尚可","普")
factor1
levels(factor1)[[1]] <- "Excellent"
levels(factor1)[c(3,4)] <- c("C","D")
factor1
factor1 <- factor(c("新北市","台北市","台中市","彰化市","基隆市","苗栗縣","苗栗縣"))
factor1
levels(factor1) <- c("中部","北部","北部","中部","北部","中部")
factor1
factor1 <- factor(c("0-4歲","5-9歲","10歲以上","0-4歲","5-9歲","5-9歲","10歲以上"))
factor1
levels(factor1) <- c("0-9歲","10歲以上","0-9歲")
factor1
covid19$地區 <- covid19$縣市
levels(covid19$地區)
currentLevels <- levels(covid19$地區)
# 整併
north_regex <- "宜蘭縣|基隆市|[台臺]北市|新北市|桃園市|新竹市|新竹縣"
middle_regex <- "苗栗縣|[台臺]中市|彰化縣|南投縣|雲林縣"
south_regex <-
"嘉義市|嘉義縣|[台臺]南[縣市]|高雄市|屏東縣|澎湖縣"
east_regex <- "花蓮縣|台東縣"
currentLevels <- str_replace(currentLevels,
north_regex, "北部")
covid19$地區
currentLevels
currentLevels <- str_replace(currentLevels,
middle_regex, "中部")
currentLevels <- str_replace(currentLevels,
south_regex, "南部")
newLevels <- str_replace(currentLevels,
east_regex, "東部")
levels(covid19$地區) <- newLevels
covid19$地區
currentLevels
covid19$地區 <- covid19$縣市
levels(covid19$地區)
currentLevels <- levels(covid19$地區)
# 整併
north_regex <- "宜蘭縣|基隆市|[台臺]北市|新北市|桃園市|新竹市|新竹縣"
middle_regex <- "苗栗縣|[台臺]中市|彰化縣|南投縣|雲林縣"
south_regex <-
"嘉義市|嘉義縣|[台臺]南[縣市]|高雄市|屏東縣|澎湖縣"
east_regex <- "花蓮縣|台東縣"
currentLevels <- str_replace(currentLevels,
north_regex, "北部")
currentLevels <- str_replace(currentLevels,
middle_regex, "中部")
currentLevels <- str_replace(currentLevels,
south_regex, "南部")
newLevels <- str_replace(currentLevels,
east_regex, "東部")
levels(covid19$地區) <- newLevels
covid19$地區
levels(covid19$年齡層)
# 創造10歲間距的所有可能
start <- seq(5, 55, by=10) # 由5到55，每個值差10的數值向量
end <- seq(14, 64, by=10)
middleLevels <-
rep(
paste0(start,"-",end),
each=2) # 每個新間距要2個
newLevels <- c("4", middleLevels, "65+", "65+")
levels(covid19$年齡層) <- newLevels
covid19$年齡層
# 創造10歲間距的所有可能
start <- seq(5, 55, by=10) # 由5到55，每個值差10的數值向量
start
levels(covid19$年齡層)
# 創造10歲間距的所有可能
start <- seq(5, 55, by=10) # 由5到55，每個值差10的數值向量
end <- seq(14, 64, by=10)
middleLevels <-
rep(
paste0(start,"-",end),
each=2) # 每個新間距要2個
newLevels <- c("4", middleLevels, "65+", "65+")
levels(covid19$年齡層) <- newLevels
covid19$年齡層
factor2 <-
factor(c("好","好","普通","普通", "好"))
levels(factor2)
factor2[[6]] <- "差"
factor2 # 元素6變NA
factor2 <-
factor(c("好","好","普通","普通", "好"))
levels(factor2)
# 先擴大levels
levels(factor2) <- c(levels(factor2), "差")
levels(factor2)
factor2[[6]] <- "差"
factor2
factor1[4:6] <- factor2
factor1
forcats::fct_c(factor1, factor2)
factor2 <-
factor(c("好","好","普通","普通", "好"))
levels(factor2)
# 先擴大levels
levels(factor2) <- c(levels(factor2), "差")
levels(factor2)
factor2[[6]] <- "差"
factor2
levels(factor2)[[4]] <- "尚可"
factor2[[7]] <- "尚可"
factor2
factor2 <-
factor(c("好","好","普通","普通", "好"))
levels(factor2)
# 先擴大levels
levels(factor2) <- c(levels(factor2), "差")
levels(factor2)
factor2[[6]] <- "差"
factor2
levels(factor2)[[4]] <- "尚可"
factor2[[7]] <- "尚可"
factor2
# non factor
char1 <- c("小明","小美")
char2 <- c("大雄","技安")
c(char1, char2)
# factor
factor1 <- factor(c("好", "壞", "壞"))
factor2 <- factor(c("壞", "好", "好"))
c(factor1, factor2)
factor1[4:6] <- factor2
factor1
forcats::fct_c(factor1, factor2)
knitr::opts_chunk$set(echo = F, eval=F)
library(jsonlite); library(lubridate); library(readr); library(stringr);
knitr::opts_chunk$set(echo = F, eval=F)
library(jsonlite); library(lubridate); library(readr); library(stringr);
jsonlite::fromJSON("https://www.dropbox.com/s/es19f62rijrd8i7/studentHeight.json?dl=1") -> studentHeights
View(studentHeights)
studentHeights$學年度 <- factor(studentHeights$學年度, ordered = TRUE)
studentHeights$年齡 <- factor(studentHeights$年齡, ordered = TRUE)
#levels(studentHeights$學年度)
levels(studentHeights$學年度) <- sort(levels(studentHeights$學年度))
#levels(studentHeights$年齡)
levels(studentHeights$年齡) <- sort(levels(studentHeights$年齡))
studentHeights
View(studentHeights)
jsonlite::fromJSON("https://www.dropbox.com/s/es19f62rijrd8i7/studentHeight.json?dl=1") -> studentHeights
View(studentHeights)
View(studentHeights)
jsonlite::fromJSON("https://www.dropbox.com/s/es19f62rijrd8i7/studentHeight.json?dl=1") -> sssstudentHeights
View(sssstudentHeights)
studentHeights$學年度 <- factor(studentHeights$學年度, ordered = TRUE)
studentHeights$年齡 <- factor(studentHeights$年齡, ordered = TRUE)
#levels(studentHeights$學年度)
levels(studentHeights$學年度) <- sort(levels(studentHeights$學年度))
#levels(studentHeights$年齡)
levels(studentHeights$年齡) <- sort(levels(studentHeights$年齡))
studentHeights
View(studentHeights)
levels(studentHeights$學年度)
studentHeights$學年度 <- factor(studentHeights$學年度, ordered = TRUE)
studentHeights$年齡 <- factor(studentHeights$年齡, ordered = TRUE)
levels_year <- levels(studentHeights$學年度)
levels_year <- as.integer(levels_year)
levels_year <- sort(levels_year)
#levels(studentHeights$年齡)
levels_age <- levels(studentHeights$年齡)
levels_age <- as.integer(levels_age)
levels_age <- sort(levels_age)
studentHeights
levels_year
levels_age
studentHeights$`年齡層`
class(studentHeights$`年齡層`)
#studentHeights$`年齡層`
studentHeights$`年齡層` <- factor(studentHeights$`年齡層`)
levels(studentHeights$`年齡層`)
#studentHeights$`年齡層`
studentHeights$`年齡層` <- factor(studentHeights$`年齡層`)
level_names <- levels(studentHeights$`年齡層`)
startingAges <- stringr::str_extract(level_names, "^[0-9]+")
startingAges <- as.integer(startingAges)
names(startingAges) <- level_names
sort(startingAges) -> startingAges
studentHeights$`年齡層` <-
factor(
studentHeights$`年齡層`, names(startingAges)
)
levels(studentHeights$`年齡層`)
#studentHeights$`年齡層`
studentHeights$`年齡層` <- factor(studentHeights$`年齡層`)
level_names <- levels(studentHeights$`年齡層`)
startingAges <- stringr::str_extract(level_names, "^[0-9]+")
startingAges <- as.integer(startingAges)
names(startingAges) <- level_names
sort(startingAges) -> startingAges
studentHeights$`年齡層` <-
factor(
studentHeights$`年齡層`, names(startingAges)
)
levels(studentHeights$`年齡層`)
studentHeights$`年齡層`
class(studentHeights$`年齡層`)
studentHeights$`年齡層` <- factor(studentHeights$`年齡層`, ordered = TRUE)
level_names <- levels(studentHeights$`年齡層`)
startingAges <- stringr::str_extract(level_names, "^[0-9]+")
startingAges <- as.integer(startingAges)
names(startingAges) <- level_names
sort(startingAges) -> startingAges
studentHeights$`年齡層` <-
factor(
studentHeights$`年齡層`, names(startingAges, ordered = TRUE)
)
levels(studentHeights$`年齡層`)
studentHeights$`年齡層`
class(studentHeights$`年齡層`)
studentHeights$`年齡層` <- factor(studentHeights$`年齡層`, ordered = TRUE)
level_names <- levels(studentHeights$`年齡層`)
startingAges <- stringr::str_extract(level_names, "^[0-9]+")
startingAges <- as.integer(startingAges)
names(startingAges) <- level_names
sort(startingAges) -> startingAges
studentHeights$`年齡層` <-
factor(
studentHeights$`年齡層`, names(startingAges), ordered = TRUE
)
levels(studentHeights$`年齡層`)
studentHeights$`年齡層`
class(studentHeights$`年齡層`)
class(studentHeights$平均身高)
pick_68_1 <- studentHeights$年齡層 == "6-8"
pick_68_2 <- studentHeights$類別 == "總計"
average_68 <- studentHeights$平均身高[pick_68_1 & pick_68_2]
pick_68_1
pick_68_2
average_68
# averageHeightByGroup
pick_68_1 <- studentHeights$年齡層 == "6-8"
pick_68_2 <- studentHeights$類別 == "總計"
picked_average_68 <- studentHeights$平均身高[pick_68_1 & pick_68_2]
average_68 <- mean(picked_average_68)
pick_68_1
pick_68_2
average_68
# averageHeightByGroup
pick_sum <- studentHeights$類別 == "總計"
pick_68 <- studentHeights$年齡層 == "6-8"
picked_average_68 <- studentHeights$平均身高[pick_68 & pick_sum]
average_68 <- mean(picked_average_68)
average_68
level_names
pick_sum <- studentHeights$類別 == "總計"
pick_68 <- studentHeights$年齡層 == "6-8"
picked_average_68 <- studentHeights$平均身高[pick_68 & pick_sum]
average_68 <- mean(picked_average_68)
pick_912 <- studentHeights$年齡層 == "9-12"
picked_average_912 <- studentHeights$平均身高[pick_912 & pick_sum]
average_912 <- mean(picked_average_912)
pick_1315 <- studentHeights$年齡層 == "13-15"
picked_average_1315 <- studentHeights$平均身高[pick_1315 & pick_sum]
average_1315 <- mean(picked_average_1315)
averageHeightByGroup <- c(average_68, average_912, average_1315)
level_names <- levels(studentHeights$`年齡層`)
names(averageHeightByGroup) <- level_names
averageHeightByGroup
class(averageHeightByGroup)
pick_male
pick_male <- studentHeights$類別 == "男"
pick_female <- studentHeights$類別 == "女"
pick_male
pick_female
pick_68 <- studentHeights$年齡層 == "6-8"
picked_68_male <- studentHeights$平均身高[pick_68 & pick_male]
picked_68_female <- studentHeights$平均身高[pick_68 & pick_female]
difference_68 <- picked_68_male - picked_68_female
picked_68_male
difference_68
average_difference_68 <- mean(difference_68)
average_difference_68
pick_912 <- studentHeights$年齡層 == "9-12"
picked_912_male <- studentHeights$平均身高[pick_912 & pick_male]
picked_912_female <- studentHeights$平均身高[pick_912 & pick_female]
difference_912 <- picked_912_male - picked_912_female
average_difference_912 <- mean(difference_912)
difference_912
average_difference_912
pick_1315 <- studentHeights$年齡層 == "13-15"
picked_1315_male <- studentHeights$平均身高[pick_1315 & pick_male]
picked_1315_female <- studentHeights$平均身高[pick_1315 & pick_female]
difference_1315 <- picked_1315_male - picked_1315_female
average_difference_1315 <- mean(difference_1315)
difference_1315
average_difference_1315
pick_male <- studentHeights$類別 == "男"
pick_female <- studentHeights$類別 == "女"
pick_68 <- studentHeights$年齡層 == "6-8"
picked_68_male <- studentHeights$平均身高[pick_68 & pick_male]
picked_68_female <- studentHeights$平均身高[pick_68 & pick_female]
difference_68 <- picked_68_male - picked_68_female
average_difference_68 <- mean(difference_68)
pick_912 <- studentHeights$年齡層 == "9-12"
picked_912_male <- studentHeights$平均身高[pick_912 & pick_male]
picked_912_female <- studentHeights$平均身高[pick_912 & pick_female]
difference_912 <- picked_912_male - picked_912_female
average_difference_912 <- mean(difference_912)
pick_1315 <- studentHeights$年齡層 == "13-15"
picked_1315_male <- studentHeights$平均身高[pick_1315 & pick_male]
picked_1315_female <- studentHeights$平均身高[pick_1315 & pick_female]
difference_1315 <- picked_1315_male - picked_1315_female
average_difference_1315 <- mean(difference_1315)
heightDifferenceByGroup <- c(average_difference_68, average_difference_912, average_difference_1315)
level_names <- levels(studentHeights$`年齡層`)
names(heightDifferenceByGroup) <- level_names
heightDifferenceByGroup
jsonlite::fromJSON("https://www.dropbox.com/s/bp0w8tjgrhi79x7/sameMajorDifferentWritings.json?dl=1") -> differentMajors
differentMajors
realEstateRegex <- "不動(產與城鄉環境學系?)"
realEstateRegex
aaa <- str_replace(differentMajors,realEstateRegex,"不動系")
aaa
realEstateRegex <- "不動(產|與|城|鄉|環|境|學?)系"
realEstateRegex
aaa <- str_replace(differentMajors,realEstateRegex,"不動系")
aaa
realEstateRegex <- "不動(產?|與?|城?|鄉?|環?|境?|學?)系"
realEstateRegex
aaa <- str_replace(differentMajors,realEstateRegex,"不動系")
aaa
realEstateRegex <- "不|動|產?|與?|城?|鄉?|環?|境?|學?|系"
realEstateRegex
aaa <- str_replace(differentMajors,realEstateRegex,"不動系")
aaa
realEstateRegex <- "不動|產?|與?|城?|鄉?|環?|境?|學?|系"
realEstateRegex
aaa <- str_replace(differentMajors,realEstateRegex,"不動系")
aaa
jsonlite::fromJSON("https://www.dropbox.com/s/bp0w8tjgrhi79x7/sameMajorDifferentWritings.json?dl=1") -> differentMajors
realEstateRegex <- "不動(產?)(與?)(城?)(鄉?)(環?)(境?)(學?)系"
realEstateRegex
aaa <- str_replace(differentMajors,realEstateRegex,"不動系")
aaa
differentMajors
str_replace(differentMajors,realEstateRegex,"不動系")
class(realEstateRegex)
differentMajors <- factor(differentMajors)
currentLevels <- levels(differentMajors)
currentLevels
class(currentLevels)
bSchoolRegex <- "休運系|休閒與運動管理學系|金融系|金融與合作經營學系|金融與合作學系"
bSchoolRegex
str_replace(currentLevels,bSchoolRegex,"商學院")
real_LSMRegex <- "休運系|休閒與運動管理學系"
real_FainanceRegex <- "金融系|金融與合作經營學系|金融與合作學系"
real_EconRegex <- "經濟(學?)系"
real_SocRegex <- "社會(學?)系"
real_SWRegex <- "社(會?)工(作?)(學?)系"
real_PARegex <- "公(共?)行(政?)(暨?)(政?)(策?)(學?)系"
real_EstateRegex <- "不動(產?)(與?)(城?)(鄉?)(環?)(境?)(學?)系"
differentMajors <- str_replace(differentMajors, real_LSMRegex, "休運系")
differentMajors <- str_replace(differentMajors, real_FainanceRegex, "金融系")
differentMajors <- str_replace(differentMajors, real_EconRegex, "經濟系")
differentMajors <- str_replace(differentMajors, real_SocRegex, "社會系")
differentMajors <- str_replace(differentMajors, real_SWRegex, "社工系")
differentMajors <- str_replace(differentMajors, real_PARegex, "公行系")
differentMajors <- str_replace(differentMajors, real_EstateRegex, "不動系")
differentMajors
real_LSMRegex <- "休運系|休閒與運動管理學系"
real_FainanceRegex <- "金融系|金融與合作經營學系|金融與合作學系"
real_EconRegex <- "經濟學系"
real_SocRegex <- "社會學系"
real_SWRegex <- "社(會?)工(作?)(學?)系"
real_PARegex <- "公(共?)行(政?)(暨?)(政?)(策?)(學?)系"
real_EstateRegex <- "不動(產?)(與?)(城?)(鄉?)(環?)(境?)(學?)系"
differentMajors <- str_replace(differentMajors, real_LSMRegex, "休運系")
differentMajors <- str_replace(differentMajors, real_FainanceRegex, "金融系")
differentMajors <- str_replace(differentMajors, real_EconRegex, "經濟系")
differentMajors <- str_replace(differentMajors, real_SocRegex, "社會系")
differentMajors <- str_replace(differentMajors, real_SWRegex, "社工系")
differentMajors <- str_replace(differentMajors, real_PARegex, "公行系")
differentMajors <- str_replace(differentMajors, real_EstateRegex, "不動系")
differentMajors
real_LSMRegex <- "休運系|休閒與運動管理學系"
real_FainanceRegex <- "金融系|金融與合作經營學系|金融與合作學系"
real_EconRegex <- "經濟(學?)系"
real_SocRegex <- "社會(學?)系"
real_SWRegex <- "社(會?)工(作?)(學?)系"
real_PARegex <- "公(共?)行(政?)(暨?)(政?)(策?)(學?)系"
real_EstateRegex <- "不動(產?)(與?)(城?)(鄉?)(環?)(境?)(學?)系"
differentMajors <- str_replace(differentMajors, real_LSMRegex, "休運系")
differentMajors <- str_replace(differentMajors, real_FainanceRegex, "金融系")
differentMajors <- str_replace(differentMajors, real_EconRegex, "經濟系")
differentMajors <- str_replace(differentMajors, real_SocRegex, "社會系")
differentMajors <- str_replace(differentMajors, real_SWRegex, "社工系")
differentMajors <- str_replace(differentMajors, real_PARegex, "公行系")
differentMajors <- str_replace(differentMajors, real_EstateRegex, "不動系")
differentMajors
jsonlite::fromJSON("https://www.dropbox.com/s/es19f62rijrd8i7/studentHeight.json?dl=1") -> studentHeights
studentHeights$`年齡層` <- factor(studentHeights$`年齡層`, c("6-8","9-12","13-15"), ordered = TRUE)
studentHeights$`年齡層`
school <- factor(c("商學院", "社科院", "公共事務學院"))
levels(school)
school
differentMajors <- factor(differentMajors)
currentLevels <- levels(differentMajors)
busiSchoolRegex <- "休運系|金融系"
socSchoolRegex <- "經濟系|社會系|社工系"
pSchoolRegex <- "公行系|不動系"
currentLevels <- str_replace(currentLevels,bSchoolRegex,"商學院")
currentLevels <- str_replace(currentLevels,socSchoolRegex,"社科院")
currentLevels <- str_replace(currentLevels,pSchoolRegex,"公共事務學院")
school <- factor(differentMajors, currentLevels)
levels(school)
school
differentMajors <- factor(differentMajors)
currentLevels <- levels(differentMajors)
busiSchoolRegex <- "休運系|金融系"
socSchoolRegex <- "經濟系|社會系|社工系"
pSchoolRegex <- "公行系|不動系"
currentLevels <- str_replace(currentLevels,bSchoolRegex,"商學院")
currentLevels <- str_replace(currentLevels,socSchoolRegex,"社科院")
currentLevels <- str_replace(currentLevels,pSchoolRegex,"公共事務學院")
school <- factor(differentMajors)
levels(school) <- currentLevels
school
class(school)
knitr::opts_chunk$set(echo = F, eval=F)
library(jsonlite); library(lubridate); library(readr); library(stringr);
jsonlite::fromJSON("https://www.dropbox.com/s/es19f62rijrd8i7/studentHeight.json?dl=1") -> studentHeights
studentHeights$學年度 <- factor(studentHeights$學年度, ordered = TRUE)
studentHeights$年齡 <- factor(studentHeights$年齡, ordered = TRUE)
levels_year <- levels(studentHeights$學年度)
levels_year <- as.integer(levels_year)
levels_year <- sort(levels_year)
levels_age <- levels(studentHeights$年齡)
levels_age <- as.integer(levels_age)
levels_age <- sort(levels_age)
studentHeights
studentHeights$`年齡層` <- factor(studentHeights$`年齡層`, ordered = TRUE)
level_names <- levels(studentHeights$`年齡層`)
startingAges <- stringr::str_extract(level_names, "^[0-9]+")
startingAges <- as.integer(startingAges)
names(startingAges) <- level_names
sort(startingAges) -> startingAges
studentHeights$`年齡層` <-
factor(
studentHeights$`年齡層`, names(startingAges), ordered = TRUE
)
levels(studentHeights$`年齡層`)
studentHeights$`年齡層`
pick_sum <- studentHeights$類別 == "總計"
pick_68 <- studentHeights$年齡層 == "6-8"
picked_average_68 <- studentHeights$平均身高[pick_68 & pick_sum]
average_68 <- mean(picked_average_68)
pick_912 <- studentHeights$年齡層 == "9-12"
picked_average_912 <- studentHeights$平均身高[pick_912 & pick_sum]
average_912 <- mean(picked_average_912)
pick_1315 <- studentHeights$年齡層 == "13-15"
picked_average_1315 <- studentHeights$平均身高[pick_1315 & pick_sum]
average_1315 <- mean(picked_average_1315)
averageHeightByGroup <- c(average_68, average_912, average_1315)
level_names <- levels(studentHeights$`年齡層`)
names(averageHeightByGroup) <- level_names
averageHeightByGroup
pick_male <- studentHeights$類別 == "男"
pick_female <- studentHeights$類別 == "女"
pick_68 <- studentHeights$年齡層 == "6-8"
picked_68_male <- studentHeights$平均身高[pick_68 & pick_male]
picked_68_female <- studentHeights$平均身高[pick_68 & pick_female]
difference_68 <- picked_68_male - picked_68_female
average_difference_68 <- mean(difference_68)
pick_912 <- studentHeights$年齡層 == "9-12"
picked_912_male <- studentHeights$平均身高[pick_912 & pick_male]
picked_912_female <- studentHeights$平均身高[pick_912 & pick_female]
difference_912 <- picked_912_male - picked_912_female
average_difference_912 <- mean(difference_912)
pick_1315 <- studentHeights$年齡層 == "13-15"
picked_1315_male <- studentHeights$平均身高[pick_1315 & pick_male]
picked_1315_female <- studentHeights$平均身高[pick_1315 & pick_female]
difference_1315 <- picked_1315_male - picked_1315_female
average_difference_1315 <- mean(difference_1315)
heightDifferenceByGroup <- c(average_difference_68, average_difference_912, average_difference_1315)
level_names <- levels(studentHeights$`年齡層`)
names(heightDifferenceByGroup) <- level_names
heightDifferenceByGroup
